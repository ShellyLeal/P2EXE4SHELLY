package ita.P2EXE2SHELLY;


import static org.junit.Assert.*;

import java.io.BufferedWriter;
import java.io.ByteArrayInputStream;
import java.io.FileWriter;
import org.junit.runners.MethodSorters;
import org.junit.FixMethodOrder;
import org.junit.Test;
@FixMethodOrder(MethodSorters.NAME_ASCENDING)  //executar os testes da ordem certa
public class VulnerabilityTest {
	
	@Test 
	public void readTestFixedClass(){
		FixedClass f = new FixedClass();
		try{
			BufferedWriter bw = new BufferedWriter(new FileWriter("arquivo.txt"));
			bw.write("arquivoteste");
			bw.close();
		} catch (Exception e){
			e.printStackTrace();
		}
		String inputData = "R";
		System.setIn(new ByteArrayInputStream(inputData.getBytes()));
		try {
			f.fixedMethod("arquivo.txt");
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}					
	}
	@Test 
	public void writeTestFixedClass(){
		FixedClass f = new FixedClass();
		String inputData = "W";
		System.setIn(new ByteArrayInputStream(inputData.getBytes()));
		try {
			f.fixedMethod("arquivo.txt");
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}					
	}
	
	@Test 
	public void wrongEntryTestFixedClass(){
		FixedClass f = new FixedClass();
		String inputData = "E";
		System.setIn(new ByteArrayInputStream(inputData.getBytes()));
		try {
			f.fixedMethod("arquivo.txt");
		} catch (Exception e) {
			
		}					
	}
	@Test 
	public void wrongFileFormatException(){
		FixedClass f = new FixedClass();
		try{
			BufferedWriter bw = new BufferedWriter(new FileWriter("arquivo.txt"));
			bw.write("testando||?**");
			bw.close();
		} catch (Exception e){
			e.printStackTrace();
		}
		String inputData = "R";
		System.setIn(new ByteArrayInputStream(inputData.getBytes()));
		try {
			f.fixedMethod("arquivo.txt");			
			fail("Esperado: Exception.class");

		} catch (Exception e) {
			
		}					
	}
}
